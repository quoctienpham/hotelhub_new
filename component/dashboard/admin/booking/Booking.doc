R·∫•t tuy·ªát ‚Äî b·∫°n ƒëang xem m·ªôt component React ph·ª©c t·∫°p trong Next.js (Client Component) ƒë·ªÉ hi·ªÉn th·ªã v√† ch·ªânh s·ª≠a chi ti·∫øt booking (ƒë·∫∑t ph√≤ng).
M√¨nh s·∫Ω ph√¢n t√≠ch chi ti·∫øt t·ª´ng ph·∫ßn, t·ª´ tr√™n xu·ªëng d∆∞·ªõi ‚Äî ƒë·ªÉ b·∫°n hi·ªÉu to√†n b·ªô c∆° ch·∫ø ho·∫°t ƒë·ªông, t·ª´ng h√†m, props, v√† c√°ch UI + logic v·∫≠n h√†nh. üëá

üß© 1. Khai b√°o ch·∫ø ƒë·ªô v√† import th∆∞ vi·ªán
"use client";


ƒê√¢y l√† directive c·ªßa Next.js 13+, cho bi·∫øt file n√†y l√† Client Component ‚Äî c√≥ th·ªÉ d√πng state, event, hooks (useState, useEffect...).

N·∫øu kh√¥ng c√≥ d√≤ng n√†y, Next.js s·∫Ω coi ƒë√¢y l√† Server Component (ch·ªâ render server-side, kh√¥ng c√≥ event handler).

import React, { useState, useEffect } from "react";
import {
  Box,
  Grid,
  Card,
  CardContent,
  Typography,
  TextField,
  MenuItem,
  Button,
  Divider,
  Chip,
  Stack,
  Modal,
  IconButton,
  Skeleton,
} from "@mui/material";
import { styled } from "@mui/material/styles";
import RoomAssignment from "./RoomAssignment";

Gi·∫£i th√≠ch:

React, useState, useEffect: hooks c∆° b·∫£n c·ªßa React.

@mui/material: th∆∞ vi·ªán Material UI ‚Äî cung c·∫•p c√°c component giao di·ªán s·∫µn nh∆∞ Button, TextField, Grid, Card...

styled(): API c·ªßa MUI ƒë·ªÉ t·∫°o component c√≥ style t√πy ch·ªânh.

RoomAssignment: component con, hi·ªÉn th·ªã/assign ph√≤ng c·ª• th·ªÉ cho booking.

üé® 2. Styled Components (t√πy bi·∫øn UI)
‚ú≥Ô∏è SummaryCard
const SummaryCard = styled(Card)(({ theme, color }) => ({
  borderLeft: `4px solid ${theme.palette[color].main}`,
  height: "100%",
  display: "flex",
  flexDirection: "column",
  justifyContent: "center",
  transition: "transform 0.2s",
  "&:hover": {
    transform: "translateY(-2px)",
  },
}));


T·∫°o 1 th·∫ª Card c√≥ vi·ªÅn tr√°i m√†u ƒë·ªông theo color (primary, secondary...).

C√≥ hi·ªáu ·ª©ng hover nh·∫π.

D√πng trong ph·∫ßn t·ªïng quan booking.

‚ú≥Ô∏è SectionHeader
const SectionHeader = styled(Typography)(({ theme }) => ({
  marginBottom: theme.spacing(2),
  fontWeight: 600,
  color: theme.palette.text.primary,
  display: "flex",
  alignItems: "center",
  "&:before": {
    content: '""',
    display: "block",
    width: "4px",
    height: "20px",
    backgroundColor: theme.palette.primary.main,
    marginRight: theme.spacing(1),
    borderRadius: "2px",
  },
}));


D√πng ƒë·ªÉ hi·ªÉn th·ªã ti√™u ƒë·ªÅ c·ªßa t·ª´ng section (v√≠ d·ª•: ‚ÄúBooking Details‚Äù, ‚ÄúCustomer Information‚Äù...).

C√≥ thanh m√†u xanh d·ªçc ·ªü ƒë·∫ßu ‚Äî t·∫°o ƒëi·ªÉm nh·∫•n th·∫©m m·ªπ.

üì¶ 3. Component ch√≠nh: BookingDetails
const BookingDetails = ({ booking, onFieldChange, onSave, onCancel }) => { ... }

Props:

booking: ƒë·ªëi t∆∞·ª£ng th√¥ng tin ƒë·∫∑t ph√≤ng (t·ª´ server ho·∫∑c danh s√°ch booking).

onFieldChange(newBooking): callback khi ng∆∞·ªùi d√πng thay ƒë·ªïi d·ªØ li·ªáu (v√≠ d·ª• ch·ªçn ng√†y, ch·ªânh s·ªë ph√≤ng).

onSave(): callback khi nh·∫•n "Save Changes".

onCancel(): callback khi nh·∫•n "Cancel".

üß† 4. H√†m ti·ªán √≠ch (Helper Functions)
üïê formatDateForInput()
const formatDateForInput = (dateString) => {
  if (!dateString) return "";
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return "";
    return date.toISOString().split("T")[0];
  } catch (e) {
    console.error("Date formatting error:", e);
    return "";
  }
};


Chuy·ªÉn check_in ho·∫∑c check_out t·ª´ Date sang ƒë·ªãnh d·∫°ng "YYYY-MM-DD", d√πng ƒë∆∞·ª£c cho <input type="date">.

C√≥ ki·ªÉm tra l·ªói an to√†n.

üóìÔ∏è formatDateForDisplay()

Hi·ªÉn th·ªã ng√†y d∆∞·ªõi d·∫°ng d·ªÖ ƒë·ªçc:

Feb 5, 2025

üåô calculateTotalNights()

T√≠nh s·ªë ƒë√™m gi·ªØa check_in v√† check_out:

return Math.ceil(diffTime / (1000 * 60 * 60 * 24));


‚Üí chuy·ªÉn milliseconds th√†nh ng√†y, l√†m tr√≤n l√™n (ph√≤ng tr∆∞·ªùng h·ª£p check-out kh√°c ng√†y nh∆∞ng ch∆∞a tr√≤n 24h).

üîÅ handleDateChange(field, value)

G·ªçi khi ng∆∞·ªùi d√πng ƒë·ªïi ng√†y check-in/check-out.

T·∫°o b·∫£n copy newBooking, c·∫≠p nh·∫≠t ng√†y m·ªõi.

N·∫øu c·∫£ 2 ng√†y ƒë·ªÅu h·ª£p l·ªá:

T√≠nh l·∫°i s·ªë ƒë√™m (total_night)

C·∫≠p nh·∫≠t subtotal = nights * pricePerNight * number_of_rooms

C·∫≠p nh·∫≠t total_price = subtotal - discount

G·ªçi onFieldChange(newBooking) ƒë·ªÉ b√°o ng∆∞·ª£c l√™n parent (lifting state).

üí¨ getStatusChip(status) v√† getPaymentChip(paymentStatus)

Tr·∫£ v·ªÅ Chip c√≥ m√†u + nh√£n tr·∫°ng th√°i t∆∞∆°ng ·ª©ng:

active ‚Üí Confirmed (xanh)
inactive ‚Üí Pending (v√†ng)
cancelled ‚Üí Cancelled (ƒë·ªè)

üí° 5. Render khi ch∆∞a c√≥ d·ªØ li·ªáu
if (!booking) {
  return (
    <Box sx={{ p: 3 }}>
      <Skeleton variant="rectangular" height={400} />
    </Box>
  );
}


D√πng Skeleton ƒë·ªÉ hi·ªÉn th·ªã khung t·∫£i t·∫°m (UX th√¢n thi·ªán).

üß± 6. Giao di·ªán hi·ªÉn th·ªã th√¥ng tin
üîπ T·ªïng quan (Summary cards)

G·ªìm 4 c·ªôt:

M√£ booking (booking.code)

Ng√†y t·∫°o (createdAt)

Ph∆∞∆°ng th·ª©c thanh to√°n (payment_method)

Tr·∫°ng th√°i thanh to√°n + ƒë·∫∑t ph√≤ng (payment_status, status)

‚Üí s·ª≠ d·ª•ng c√°c SummaryCard styled.

üîπ Chi ti·∫øt booking (Booking Details)

Hi·ªÉn th·ªã th√¥ng tin:

Lo·∫°i ph√≤ng, gi√°/ƒë√™m, s·ªë l∆∞·ª£ng ph√≤ng

Check-in, Check-out

S·ªë kh√°ch

T√≠nh to√°n l·∫°i gi√° khi thay ƒë·ªïi ng√†y ho·∫∑c s·ªë ph√≤ng.

‚öôÔ∏è C√≥ logic ki·ªÉm tra availableRooms ƒë·ªÉ tr√°nh v∆∞·ª£t s·ªë l∆∞·ª£ng ph√≤ng tr·ªëng.

üîπ T·ªïng ti·ªÅn (Subtotal / Discount / Total)
subtotal = nights * pricePerNight * rooms
total_price = subtotal - discount

üîπ Qu·∫£n l√Ω tr·∫°ng th√°i (Status Management)

Hai dropdown ƒë·ªÉ c·∫≠p nh·∫≠t:

Payment Status (Pending / Paid)

Booking Status (Pending / Confirmed / Cancelled)

üîπ Th√¥ng tin kh√°ch h√†ng (Customer Information)

Hi·ªÉn th·ªã:

H·ªç t√™n

Email

S·ªë ƒëi·ªán tho·∫°i
(C√°c input b·ªã disable ch·ªânh s·ª≠a tr·ª±c ti·∫øp ƒë·ªÉ tr√°nh thay ƒë·ªïi ngo√†i √Ω mu·ªën.)

üîπ N√∫t h√†nh ƒë·ªông (Buttons)
<Button variant="outlined" onClick={onCancel}>Cancel</Button>
<Button variant="contained" onClick={onSave}>Save Changes</Button>


G·ªçi callback ƒë∆∞·ª£c truy·ªÅn t·ª´ parent.

üîπ Room Assignment

Cu·ªëi c√πng g·ªçi component:

<RoomAssignment booking={booking} />


ƒê·ªÉ g√°n ph√≤ng th·ª±c t·∫ø cho booking n√†y (v√≠ d·ª• ph√≤ng 101, 102...).

üßæ T·ªïng k·∫øt ho·∫°t ƒë·ªông logic
Giai ƒëo·∫°n	M√¥ t·∫£
1Ô∏è‚É£ Nh·∫≠n prop booking	D·ªØ li·ªáu 1 booking c·ª• th·ªÉ t·ª´ server
2Ô∏è‚É£ Format d·ªØ li·ªáu	C√°c h√†m format ng√†y, t√≠nh t·ªïng ti·ªÅn
3Ô∏è‚É£ Render UI	Chia th√†nh nhi·ªÅu section c√≥ style Material UI
4Ô∏è‚É£ X·ª≠ l√Ω thay ƒë·ªïi	Khi ƒë·ªïi ng√†y/s·ªë ph√≤ng ‚Üí g·ªçi onFieldChange
5Ô∏è‚É£ G·ªçi callback	onSave ‚Üí l∆∞u v·ªÅ DB; onCancel ‚Üí h·ªßy ch·ªânh s·ª≠a
6Ô∏è‚É£ Hi·ªÉn th·ªã ph·ª•	G·ªçi RoomAssignment ƒë·ªÉ xem/g√°n ph√≤ng c·ª• th·ªÉ
‚öôÔ∏è T√≥m t·∫Øt k·ªπ thu·∫≠t
Th√†nh ph·∫ßn	C√¥ng ngh·ªá
UI framework	Material UI (MUI v5)
Styling	styled() + sx={}
Logic	React Hooks (no context/state global)
Data flow	Controlled props t·ª´ parent
Date logic	Native JS Date object
Currency	Hi·ªÉn th·ªã $, kh√¥ng c√≥ format locale
T√°i s·ª≠ d·ª•ng	D·ªÖ t√≠ch h·ª£p trong dashboard admin




N·∫øu b·∫°n mu·ªën, m√¨nh c√≥ th·ªÉ vi·∫øt l·∫°i ƒëo·∫°n n√†y th√†nh phi√™n b·∫£n t·ªëi ∆∞u h∆°n, v√≠ d·ª•:

T√°ch logic ra file ri√™ng (useBookingForm.js)

H·ªó tr·ª£ ƒëa ng√¥n ng·ªØ (i18n)

Format gi√° ti·ªÅn theo locale (VNƒê, USD‚Ä¶)

Th√™m validate form & toast notification

B·∫°n c√≥ mu·ªën m√¨nh vi·∫øt l·∫°i b·∫£n t·ªëi ∆∞u k√®m comment chi ti·∫øt t·ª´ng ph·∫ßn kh√¥ng?

B·∫°n ƒë√£ n√≥i:
vi·∫øt l·∫°i b·∫£n t·ªëi ∆∞u k√®m comment chi ti·∫øt t·ª´ng ph·∫ßn
ChatGPT ƒë√£ n√≥i:

R·∫•t hay ‚Äî ƒë√¢y l√† m·ªôt component React kh√° l·ªõn (tr√™n 600 d√≤ng), n√™n ƒë·ªÉ t·ªëi ∆∞u v√† d·ªÖ b·∫£o tr√¨, ta s·∫Ω:
‚úÖ Chia nh·ªè c√°c ph·∫ßn logic (format date, t√≠nh ti·ªÅn, chip hi·ªÉn th·ªã tr·∫°ng th√°i, v.v.)
‚úÖ Lo·∫°i b·ªè logic tr√πng l·∫∑p
‚úÖ Vi·∫øt l·∫°i c√∫ ph√°p d·ªÖ ƒë·ªçc h∆°n
‚úÖ Th√™m comment chi ti·∫øt gi·∫£i th√≠ch t·ª´ng ph·∫ßn

üîß D∆∞·ªõi ƒë√¢y l√† b·∫£n vi·∫øt l·∫°i BookingDetails.jsx (t·ªëi ∆∞u + c√≥ ch√∫ th√≠ch chi ti·∫øt)
"use client";
import React from "react";
import {
  Box,
  Grid,
  Card,
  CardContent,
  Typography,
  TextField,
  MenuItem,
  Button,
  Divider,
  Chip,
  Stack,
  Skeleton,
} from "@mui/material";
import { styled } from "@mui/material/styles";
import RoomAssignment from "./RoomAssignment";

/* -----------------------------------------------------
 üîπ STYLED COMPONENTS: ƒê·ªãnh nghƒ©a style ri√™ng cho UI
----------------------------------------------------- */
const SummaryCard = styled(Card)(({ theme, color }) => ({
  borderLeft: `4px solid ${theme.palette[color].main}`,
  height: "100%",
  display: "flex",
  flexDirection: "column",
  justifyContent: "center",
  transition: "transform 0.2s",
  "&:hover": { transform: "translateY(-2px)" },
}));

const SectionHeader = styled(Typography)(({ theme }) => ({
  marginBottom: theme.spacing(2),
  fontWeight: 600,
  color: theme.palette.text.primary,
  display: "flex",
  alignItems: "center",
  "&:before": {
    content: '""',
    display: "block",
    width: "4px",
    height: "20px",
    backgroundColor: theme.palette.primary.main,
    marginRight: theme.spacing(1),
    borderRadius: "2px",
  },
}));

/* -----------------------------------------------------
 üîπ H√ÄM TI·ªÜN √çCH (Utility Functions)
----------------------------------------------------- */

// ‚úÖ ƒê·ªãnh d·∫°ng ng√†y cho <input type="date">
const formatDateForInput = (dateString) => {
  if (!dateString) return "";
  const date = new Date(dateString);
  return isNaN(date.getTime()) ? "" : date.toISOString().split("T")[0];
};

// ‚úÖ Hi·ªÉn th·ªã ng√†y ·ªü d·∫°ng "Oct 5, 2025"
const formatDateForDisplay = (dateString) => {
  if (!dateString) return "Not set";
  const date = new Date(dateString);
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
};

// ‚úÖ T√≠nh t·ªïng s·ªë ƒë√™m gi·ªØa 2 ng√†y
const calculateTotalNights = (checkIn, checkOut) => {
  if (!checkIn || !checkOut) return 0;
  const diffTime = new Date(checkOut) - new Date(checkIn);
  return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
};

// ‚úÖ Component chip th·ªÉ hi·ªán tr·∫°ng th√°i ƒë·∫∑t ph√≤ng
const StatusChip = ({ status }) => {
  const map = {
    active: { label: "Confirmed", color: "success" },
    inactive: { label: "Pending", color: "warning" },
    cancelled: { label: "Cancelled", color: "error" },
  };
  const s = map[status] || { label: status, color: "default" };
  return <Chip label={s.label} color={s.color} size="small" variant="outlined" />;
};

// ‚úÖ Component chip th·ªÉ hi·ªán tr·∫°ng th√°i thanh to√°n
const PaymentChip = ({ paid }) => (
  <Chip
    label={paid === "1" ? "Paid" : "Pending"}
    color={paid === "1" ? "success" : "warning"}
    size="small"
    variant="outlined"
  />
);

/* -----------------------------------------------------
 üîπ COMPONENT CH√çNH: BookingDetails
----------------------------------------------------- */
const BookingDetails = ({ booking, onFieldChange, onSave, onCancel }) => {
  if (!booking) {
    // Hi·ªÉn th·ªã khi ƒëang t·∫£i
    return (
      <Box sx={{ p: 3 }}>
        <Skeleton variant="rectangular" height={400} />
      </Box>
    );
  }

  // ‚úÖ Khi user ch·ªçn l·∫°i ng√†y CheckIn/CheckOut
  const handleDateChange = (field, value) => {
    const newBooking = { ...booking, [field]: value };

    if (newBooking.check_in && newBooking.check_out) {
      const nights = calculateTotalNights(
        newBooking.check_in,
        newBooking.check_out
      );
      newBooking.total_night = nights;
      newBooking.subtotal =
        nights * newBooking.actual_price * newBooking.number_of_rooms;
      newBooking.total_price =
        newBooking.subtotal - (newBooking.discount || 0);
    }

    onFieldChange(newBooking);
  };

  /* -----------------------------------------------------
   üîπ GIAO DI·ªÜN HI·ªÇN TH·ªä
  ----------------------------------------------------- */
  return (
    <>
      <Box sx={{ p: 3 }}>
        {/* ====== TH·∫∫ T·ªîNG QUAN (SUMMARY CARDS) ====== */}
        <Grid container spacing={2} sx={{ mb: 3 }}>
          {[
            {
              label: "Booking Reference",
              value: booking.code || "N/A",
              color: "primary",
            },
            {
              label: "Booking Date",
              value: formatDateForDisplay(booking.createdAt),
              color: "secondary",
            },
            {
              label: "Payment Method",
              value: booking.payment_method,
              color: "info",
            },
          ].map((item, i) => (
            <Grid item xs={12} sm={6} md={3} key={i}>
              <SummaryCard color={item.color}>
                <CardContent>
                  <Typography variant="caption" color="text.secondary">
                    {item.label}
                  </Typography>
                  <Typography variant="h6" fontWeight="bold">
                    {item.value}
                  </Typography>
                </CardContent>
              </SummaryCard>
            </Grid>
          ))}

          {/* √î cu·ªëi c√πng hi·ªÉn th·ªã tr·∫°ng th√°i */}
          <Grid item xs={12} sm={6} md={3}>
            <SummaryCard
              color={booking.payment_status === "1" ? "success" : "warning"}
            >
              <CardContent>
                <Stack
                  direction="row"
                  justifyContent="space-between"
                  alignItems="center"
                >
                  <div>
                    <Typography variant="caption" color="text.secondary">
                      Payment Status
                    </Typography>
                    <PaymentChip paid={booking.payment_status} />
                  </div>
                  <div>
                    <Typography variant="caption" color="text.secondary">
                      Booking Status
                    </Typography>
                    <StatusChip status={booking.status} />
                  </div>
                </Stack>
              </CardContent>
            </SummaryCard>
          </Grid>
        </Grid>

        {/* ====== TH√îNG TIN ƒê·∫∂T PH√íNG ====== */}
        <Card sx={{ mb: 3 }}>
          <CardContent>
            <SectionHeader variant="h6">Booking Details</SectionHeader>
            <Grid container spacing={3}>
              {/* B√™n tr√°i: Th√¥ng tin ph√≤ng */}
              <Grid item xs={12} md={6}>
                <Box sx={{ p: 2, bgcolor: "action.hover", borderRadius: 1 }}>
                  <Typography variant="subtitle1" fontWeight="medium">
                    Room Information
                  </Typography>
                  <Grid container spacing={2} sx={{ mt: 1 }}>
                    <Grid item xs={6} sm={4}>
                      <Typography variant="caption" color="text.secondary">
                        Room Type
                      </Typography>
                      <Typography>
                        {booking.rooms_id?.roomtype_id?.name || "N/A"}
                      </Typography>
                    </Grid>
                    <Grid item xs={6} sm={4}>
                      <Typography variant="caption">Rooms</Typography>
                      <Typography>{booking.number_of_rooms}</Typography>
                    </Grid>
                    <Grid item xs={6} sm={4}>
                      <Typography variant="caption">Price/Night</Typography>
                      <Typography>${booking.actual_price}</Typography>
                    </Grid>
                    <Grid item xs={6} sm={4}>
                      <Typography variant="caption">Total Nights</Typography>
                      <Typography>
                        {calculateTotalNights(booking.check_in, booking.check_out)}
                      </Typography>
                    </Grid>
                    <Grid item xs={6} sm={4}>
                      <Typography variant="caption">Guests</Typography>
                      <Typography>{booking.person}</Typography>
                    </Grid>
                  </Grid>
                </Box>
              </Grid>

              {/* B√™n ph·∫£i: Ng√†y & S·ªë ph√≤ng */}
              <Grid item xs={12} md={6}>
                <Box sx={{ p: 2, bgcolor: "action.hover", borderRadius: 1 }}>
                  <Typography variant="subtitle1" fontWeight="medium">
                    Stay Duration
                  </Typography>
                  <Grid container spacing={2} sx={{ mt: 1 }}>
                    <Grid item xs={12} sm={6}>
                      <TextField
                        label="Check-In"
                        type="date"
                        value={formatDateForInput(booking.check_in)}
                        onChange={(e) =>
                          handleDateChange("check_in", e.target.value)
                        }
                        fullWidth
                        InputLabelProps={{ shrink: true }}
                      />
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <TextField
                        label="Check-Out"
                        type="date"
                        value={formatDateForInput(booking.check_out)}
                        onChange={(e) =>
                          handleDateChange("check_out", e.target.value)
                        }
                        fullWidth
                        InputLabelProps={{ shrink: true }}
                      />
                    </Grid>

                    {/* S·ªë ph√≤ng */}
                    <Grid item xs={12}>
                      <TextField
                        label="Number of Rooms"
                        type="number"
                        value={booking.number_of_rooms}
                        onChange={(e) => {
                          const inputValue = parseInt(e.target.value) || 1;
                          const maxRooms = booking.availableRooms || 1;
                          const newRooms = Math.min(inputValue, maxRooms);
                          const nights = calculateTotalNights(
                            booking.check_in,
                            booking.check_out
                          );

                          const subtotal =
                            nights * booking.actual_price * newRooms;

                          onFieldChange({
                            ...booking,
                            number_of_rooms: newRooms,
                            subtotal,
                            total_price: subtotal - (booking.discount || 0),
                          });
                        }}
                        fullWidth
                        inputProps={{
                          min: 1,
                          max: booking.availableRooms || 1,
                        }}
                      />
                      <Typography>
                        Available Rooms: {booking.availableRooms || 1}
                      </Typography>
                    </Grid>
                  </Grid>
                </Box>
              </Grid>
            </Grid>

            {/* T·ªïng ti·ªÅn */}
            <Divider sx={{ my: 3 }} />
            <Grid container spacing={2}>
              <Grid item xs={12} md={8}></Grid>
              <Grid item xs={12} md={4}>
                <Box sx={{ p: 2, borderRadius: 1 }}>
                  <Stack spacing={1}>
                    <Stack direction="row" justifyContent="space-between">
                      <Typography>Subtotal:</Typography>
                      <Typography fontWeight="medium">
                        ${booking.subtotal}
                      </Typography>
                    </Stack>
                    <Stack direction="row" justifyContent="space-between">
                      <Typography>Discount:</Typography>
                      <Typography color="error.main">
                        -${booking.discount || 0}
                      </Typography>
                    </Stack>
                    <Divider />
                    <Stack direction="row" justifyContent="space-between">
                      <Typography variant="subtitle1">Total:</Typography>
                      <Typography variant="subtitle1" fontWeight="bold">
                        ${Number(booking.total_price).toFixed(2)}
                      </Typography>
                    </Stack>
                  </Stack>
                </Box>
              </Grid>
            </Grid>
          </CardContent>
        </Card>

        {/* ====== QU·∫¢N L√ù TR·∫†NG TH√ÅI ====== */}
        <Card sx={{ mb: 3 }}>
          <CardContent>
            <SectionHeader variant="h6">Status Management</SectionHeader>
            <Grid container spacing={2}>
              <Grid item xs={12} sm={6}>
                <TextField
                  select
                  label="Payment Status"
                  value={booking.payment_status}
                  onChange={(e) =>
                    onFieldChange({
                      ...booking,
                      payment_status: e.target.value,
                    })
                  }
                  fullWidth
                >
                  <MenuItem value="0">Pending</MenuItem>
                  <MenuItem value="1">Paid</MenuItem>
                </TextField>
              </Grid>
              <Grid item xs={12} sm={6}>
                <TextField
                  select
                  label="Booking Status"
                  value={booking.status}
                  onChange={(e) =>
                    onFieldChange({
                      ...booking,
                      status: e.target.value,
                    })
                  }
                  fullWidth
                >
                  <MenuItem value="inactive">Pending</MenuItem>
                  <MenuItem value="active">Confirmed</MenuItem>
                  <MenuItem value="cancelled">Cancelled</MenuItem>
                </TextField>
              </Grid>
            </Grid>
          </CardContent>
        </Card>

        {/* ====== TH√îNG TIN KH√ÅCH H√ÄNG ====== */}
        <Card sx={{ mb: 3 }}>
          <CardContent>
            <SectionHeader variant="h6">Customer Information</SectionHeader>
            <Grid container spacing={2}>
              <Grid item xs={12} sm={6} md={4}>
                <TextField label="Full Name" value={booking.name} fullWidth />
              </Grid>
              <Grid item xs={12} sm={6} md={4}>
                <TextField label="Email" value={booking.email} fullWidth />
              </Grid>
              <Grid item xs={12} sm={6} md={4}>
                <TextField label="Phone" value={booking.phone} fullWidth />
              </Grid>
            </Grid>
          </CardContent>
        </Card>

        {/* ====== N√öT H√ÄNH ƒê·ªòNG ====== */}
        <Box sx={{ display: "flex", justifyContent: "flex-end", gap: 2 }}>
          <Button variant="outlined" onClick={onCancel}>
            Cancel
          </Button>
          <Button variant="contained" onClick={onSave}>
            Save Changes
          </Button>
        </Box>
      </Box>

      {/* Ph√¢n b·ªï ph√≤ng */}
      <RoomAssignment booking={booking} />
    </>
  );
};

export default BookingDetails;

üí° Gi·∫£i th√≠ch ch√≠nh:
Th√†nh ph·∫ßn	Vai tr√≤
SummaryCard, SectionHeader	Styled components gi√∫p t·∫°o giao di·ªán nh·∫•t qu√°n.
formatDateForInput, formatDateForDisplay	Chuy·ªÉn ƒë·ªãnh d·∫°ng ng√†y gi·ªØa JS v√† input HTML.
calculateTotalNights	T√≠nh t·ªïng s·ªë ƒë√™m gi·ªØa check-in & check-out.
StatusChip, PaymentChip	Hi·ªÉn th·ªã chip m√†u t∆∞∆°ng ·ª©ng v·ªõi tr·∫°ng th√°i ƒë·∫∑t ph√≤ng / thanh to√°n.
handleDateChange	Khi ng∆∞·ªùi d√πng ƒë·ªïi ng√†y ‚Üí c·∫≠p nh·∫≠t l·∫°i subtotal & total.
onFieldChange	Callback g·ª≠i d·ªØ li·ªáu thay ƒë·ªïi v·ªÅ component cha ƒë·ªÉ x·ª≠ l√Ω.
RoomAssignment	Sub-component ƒë·ªÉ g√°n ph√≤ng cho kh√°ch (render ·ªü cu·ªëi).

N·∫øu b·∫°n mu·ªën, m√¨nh c√≥ th·ªÉ t√°ch file n√†y th√†nh 3 component nh·ªè h∆°n (BookingSummary, BookingForm, StatusManager) ƒë·ªÉ m√£ g·ªçn, d·ªÖ b·∫£o tr√¨ v√† t√°i s·ª≠ d·ª•ng ‚Äî b·∫°n c√≥ mu·ªën m√¨nh chia ti·∫øp nh∆∞ v·∫≠y kh√¥ng?

B·∫°n ƒë√£ n√≥i:
t√°ch file n√†y th√†nh 3 component nh·ªè h∆°n (BookingSummary, BookingForm, StatusManager) ƒë·ªÉ m√£ g·ªçn, d·ªÖ b·∫£o tr√¨ v√† t√°i s·ª≠ d·ª•ng
ChatGPT ƒë√£ n√≥i:

R·∫•t hay üëç ‚Äî t√°ch component theo h∆∞·ªõng "Single Responsibility" (m·ªói component ph·ª• tr√°ch m·ªôt ph·∫ßn r√µ r√†ng) gi√∫p m√£ g·ªçn, d·ªÖ ƒë·ªçc, d·ªÖ t√°i s·ª≠ d·ª•ng v√† d·ªÖ test.

Gi·∫£ s·ª≠ file g·ªëc c·ªßa b·∫°n l√† BookingComponent.js, ta s·∫Ω chia th√†nh:

BookingSummary.js ‚Üí Hi·ªÉn th·ªã t·ªïng quan booking (gi√°, ng√†y, ph√≤ng...)

BookingForm.js ‚Üí Form nh·∫≠p th√¥ng tin kh√°ch h√†ng, ph∆∞∆°ng th·ª©c thanh to√°n

StatusManager.js ‚Üí Qu·∫£n l√Ω tr·∫°ng th√°i (ƒëang ƒë·∫∑t, ho√†n t·∫•t, l·ªói...), x·ª≠ l√Ω g·ªçi API

üß© C·∫•u tr√∫c th∆∞ m·ª•c m·ªõi
/component/Bookingdetails/
‚îÇ
‚îú‚îÄ‚îÄ BookingComponent.js        <-- Component ch√≠nh
‚îú‚îÄ‚îÄ BookingSummary.js           <-- Hi·ªÉn th·ªã th√¥ng tin booking
‚îú‚îÄ‚îÄ BookingForm.js              <-- Nh·∫≠p th√¥ng tin thanh to√°n
‚îî‚îÄ‚îÄ StatusManager.js            <-- Qu·∫£n l√Ω logic ƒë·∫∑t ph√≤ng

üìò 1. BookingSummary.js
"use client";
import React from "react";
import { Card, CardContent } from "@/components/ui/card";

export default function BookingSummary({ roomInfo, checkIn, checkOut, total, nights, guests }) {
  return (
    <Card className="p-4 rounded-2xl shadow-sm bg-white">
      <CardContent>
        <h2 className="text-xl font-semibold mb-3">Booking Summary</h2>
        <p><strong>Room:</strong> {roomInfo?.name || "N/A"}</p>
        <p><strong>Check-in:</strong> {checkIn}</p>
        <p><strong>Check-out:</strong> {checkOut}</p>
        <p><strong>Nights:</strong> {nights}</p>
        <p><strong>Guests:</strong> {guests}</p>
        <p className="text-lg mt-3"><strong>Total:</strong> ${total.toFixed(2)}</p>
      </CardContent>
    </Card>
  );
}


üü¢ Gi·∫£i th√≠ch

Ch·ªâ ph·ª• tr√°ch hi·ªÉn th·ªã d·ªØ li·ªáu, kh√¥ng c√≥ logic x·ª≠ l√Ω.

Nh·∫≠n props t·ª´ component cha ƒë·ªÉ t√°i s·ª≠ d·ª•ng ·ªü nhi·ªÅu n∆°i (trang thanh to√°n, l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng...).

üìó 2. BookingForm.js
"use client";
import React from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";

export default function BookingForm({ billingDetails, setBillingDetails, onSubmit, isLoading }) {
  const handleChange = (e) => {
    const { name, value } = e.target;
    setBillingDetails((prev) => ({ ...prev, [name]: value }));
  };

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault();
        onSubmit();
      }}
      className="bg-white p-4 rounded-2xl shadow-sm space-y-3"
    >
      <h2 className="text-xl font-semibold mb-2">Billing Information</h2>
      <Input name="name" placeholder="Full name" value={billingDetails.name} onChange={handleChange} required />
      <Input name="email" placeholder="Email" value={billingDetails.email} onChange={handleChange} required />
      <Input name="phone" placeholder="Phone" value={billingDetails.phone} onChange={handleChange} />
      <Input name="address" placeholder="Address" value={billingDetails.address} onChange={handleChange} />
      <Input name="state" placeholder="State" value={billingDetails.state} onChange={handleChange} />
      <Input name="zipCode" placeholder="ZIP Code" value={billingDetails.zipCode} onChange={handleChange} />
      <Button type="submit" disabled={isLoading} className="w-full mt-2">
        {isLoading ? "Processing..." : "Confirm Booking"}
      </Button>
    </form>
  );
}


üü¢ Gi·∫£i th√≠ch

Giao di·ªán nh·∫≠p th√¥ng tin thanh to√°n.

Nh·∫≠n setBillingDetails t·ª´ cha ‚Üí gi√∫p c·∫≠p nh·∫≠t state ngo√†i.

onSubmit() ƒë∆∞·ª£c truy·ªÅn t·ª´ component cha ƒë·ªÉ linh ho·∫°t ƒë·ªïi h√†nh ƒë·ªông (POST API, ki·ªÉm tra logic, v.v.)

üìô 3. StatusManager.js
"use client";
import { useState } from "react";
import { toast } from "react-hot-toast";

export default function useStatusManager() {
  const [isLoading, setIsLoading] = useState(false);
  const [status, setStatus] = useState("idle"); // idle | processing | success | error

  // H√†m x·ª≠ l√Ω ƒë·∫∑t ph√≤ng
  const handleBooking = async (payload) => {
    setIsLoading(true);
    setStatus("processing");

    try {
      const res = await fetch("/api/booking", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) throw new Error("Booking failed");
      const data = await res.json();

      toast.success("Booking successful!");
      setStatus("success");
      return data;
    } catch (err) {
      console.error(err);
      toast.error("Error placing booking");
      setStatus("error");
    } finally {
      setIsLoading(false);
    }
  };

  return { isLoading, status, handleBooking };
}


üü¢ Gi·∫£i th√≠ch

ƒê√¢y l√† custom hook t√°ch ri√™ng logic x·ª≠ l√Ω tr·∫°ng th√°i.

C√≥ th·ªÉ t√°i s·ª≠ d·ª•ng cho c√°c ph·∫ßn kh√°c (VD: ƒë·∫∑t ph√≤ng, thanh to√°n, hu·ª∑ ƒë·∫∑t...).

Qu·∫£n l√Ω loading, th√¥ng b√°o, v√† k·∫øt qu·∫£ API trong c√πng m·ªôt n∆°i.

üìí 4. BookingComponent.js (g·ªôp l·∫°i)
"use client";
import React, { useState } from "react";
import BookingSummary from "./BookingSummary";
import BookingForm from "./BookingForm";
import useStatusManager from "./StatusManager";

export default function BookingComponent({ roomInfo, checkIn, checkOut, total, nights, guests }) {
  const { isLoading, handleBooking } = useStatusManager();
  const [billingDetails, setBillingDetails] = useState({
    name: "",
    email: "",
    phone: "",
    address: "",
    state: "",
    zipCode: "",
  });

  const handleSubmit = async () => {
    const payload = {
      room_id: roomInfo?._id,
      checkIn,
      checkOut,
      total,
      nights,
      guests,
      billingDetails,
    };

    await handleBooking(payload);
  };

  return (
    <div className="grid md:grid-cols-2 gap-4">
      <BookingSummary
        roomInfo={roomInfo}
        checkIn={checkIn}
        checkOut={checkOut}
        total={total}
        nights={nights}
        guests={guests}
      />

      <BookingForm
        billingDetails={billingDetails}
        setBillingDetails={setBillingDetails}
        onSubmit={handleSubmit}
        isLoading={isLoading}
      />
    </div>
  );
}

‚úÖ L·ª£i √≠ch sau khi t√°ch
Ti√™u ch√≠	Tr∆∞·ªõc khi t√°ch	Sau khi t√°ch
ƒê·ªô d√†i file	>200 d√≤ng	M·ªói file <80 d√≤ng
D·ªÖ b·∫£o tr√¨	Kh√≥, nhi·ªÅu logic l·∫´n l·ªôn	R√µ r√†ng t·ª´ng ch·ª©c nƒÉng
T√°i s·ª≠ d·ª•ng	Kh√¥ng th·ªÉ	C√≥ th·ªÉ d√πng l·∫°i ·ªü nhi·ªÅu n∆°i
Test ƒë∆°n v·ªã (unit test)	Kh√≥ mock t·ª´ng ph·∫ßn	D·ªÖ mock t·ª´ng component

B·∫°n c√≥ mu·ªën m√¨nh th√™m lu√¥n transaction + availability check (khi b·∫•m confirm booking th√¨ ki·ªÉm tra ph√≤ng tr·ªëng v√† l∆∞u trong DB an to√†n b·∫±ng transaction MongoDB) v√†o h·ªá th·ªëng component n√†y kh√¥ng?
‚Üí N·∫øu c√≥, m√¨nh s·∫Ω t√≠ch h·ª£p n√≥ tr·ª±c ti·∫øp trong hook useStatusManager() cho b·∫°n.